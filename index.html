<body>
	<canvas id="c" >
<script>
	a = new Image()
	a.src="a.png"
	context=c.getContext("2d")
	context.imageSmoothingEnabled = false;
	c.width=context.width=720
	c.height=context.height=480
	map=[];
	for (i=0;i<30;i++){
		map[i]=[];
			for(j=0;j<20;j++){
				map[i][j]=Math.random()<0.2?1:0;
				map[i][j]=Math.random()<0.01?2:map[i][j];
			}
	}
	players=[{x:5,y:10,id:0},{x:25,y:10,id:1}];
	timer=0;
	setInterval(function(){
		timer++;
		for (i=0;i<30;i++){
			for(j=0;j<20;j++){
				switch(map[i][j]){
					case 0:
				context.drawImage(a,0,(7*i+5*j+50*Math.round(Math.sin(i/4))+50*Math.round(Math.cos(j/5)))%16,8,8,i*20,j*20,24,24);
				break;
				case 1:
				context.drawImage(a,8,0,8,8,i*20,j*20,24,24);
				break;
				case 2:
				context.drawImage(a,32,8*(timer%3),8,8,i*20,j*20,24,24);
				break;
				}
			}
		}
		players.forEach(function(x){
			context.drawImage(a,16+8*x.id,8*(timer%3),8,8,x.x*20,x.y*20,24,24);
		});
		if((timer%6)<3){
			context.drawImage(a,8,8,8,8,players[currentPlayer].x*20,players[currentPlayer].y*20,24,24);
		}
	},200)
	
	currentPlayer=0
	
	window.addEventListener("keydown",function(e){
		x=0;
		y=0;
		x=e.keyCode==37?x-1:x;
		x=e.keyCode==39?x+1:x;
		y=e.keyCode==38?y-1:y;
		y=e.keyCode==40?y+1:y;
		movePlayer(x,y,currentPlayer);
	});
	
	function movePlayer(x,y,i){
		if(map[players[i].x+x][players[i].y+y]==0){
			players[i].x+=x;
			players[i].y+=y;
			movePlayer(x,y,i);
		}else {
			currentPlayer=(currentPlayer+1)%2
		}
	}
</script>